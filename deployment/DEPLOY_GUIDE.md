# æœåŠ¡å™¨éƒ¨ç½²å¿«é€ŸæŒ‡å—

## ğŸš€ æ™ºèƒ½æ„å»ºç­–ç•¥ï¼ˆv2.1 æ›´æ–°ï¼‰

éƒ¨ç½²è„šæœ¬å·²ä¼˜åŒ–ï¼Œ**ä¸ä¼šæ¯æ¬¡éƒ½é‡æ–°ä¸‹è½½ä¾èµ–**ï¼Œå¤§å¹…æå‡éƒ¨ç½²é€Ÿåº¦ï¼

### æ„å»ºç­–ç•¥

| åœºæ™¯ | å‘½ä»¤ | è¯´æ˜ | è€—æ—¶ |
|------|------|------|------|
| **é¦–æ¬¡éƒ¨ç½²** | `./deploy.sh deploy` | è‡ªåŠ¨æ„å»ºé•œåƒï¼ˆä¸‹è½½ä¾èµ–ï¼‰ | ~5-10åˆ†é’Ÿ |
| **ä»£ç æ›´æ–°** | `./deploy.sh deploy` | æ™ºèƒ½é‡å»ºï¼Œåˆ©ç”¨Dockerå±‚ç¼“å­˜ | ~30ç§’ |
| **ä¾èµ–æ›´æ–°** | `./deploy.sh deploy --build` | å¼ºåˆ¶é‡æ–°å®‰è£…ä¾èµ– | ~5-10åˆ†é’Ÿ |
| **å¿«é€Ÿå¯åŠ¨** | `./deploy.sh start` | è·³è¿‡æ„å»ºï¼Œç›´æ¥å¯åŠ¨ | ~5ç§’ |

### Docker åˆ†å±‚ç¼“å­˜åŸç†

```dockerfile
# Dockerfile åˆ†å±‚ç»“æ„ï¼ˆå·²ä¼˜åŒ–ï¼‰
FROM python:3.11-slim                    # åŸºç¡€é•œåƒå±‚
WORKDIR /app
COPY requirements.txt .                   # ä¾èµ–å£°æ˜å±‚
RUN pip install -r requirements.txt       # ä¾èµ–å®‰è£…å±‚ï¼ˆç¼“å­˜ï¼ï¼‰
COPY src/ src/                            # ä»£ç å±‚ï¼ˆç»å¸¸å˜ï¼‰
COPY scripts/ scripts/                    # ä»£ç å±‚ï¼ˆç»å¸¸å˜ï¼‰
```

**å…³é”®ç‚¹**ï¼š
- âœ… requirements.txt åœ¨å‰ï¼Œä»£ç åœ¨å
- âœ… åªæœ‰ requirements.txt å˜åŒ–æ‰é‡æ–°ä¸‹è½½ä¾èµ–
- âœ… ä»£ç å˜åŒ–åªéœ€é‡å»ºä»£ç å±‚ï¼Œä¾èµ–å±‚å¤ç”¨ç¼“å­˜

---

## ğŸ“ å¸¸ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šé¦–æ¬¡éƒ¨ç½²

```bash
cd deployment
./deploy.sh deploy
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
ğŸš€ å¼€å§‹éƒ¨ç½² AI è°£è¨€ç²‰ç¢æœº
âœ… Docker ç¯å¢ƒæ­£å¸¸
âœ… ä½¿ç”¨ Docker Compose V2
âœ… .env æ–‡ä»¶æ£€æŸ¥é€šè¿‡
[æ­¥éª¤] æ¸…ç†æ—§å®¹å™¨...
[æ­¥éª¤] é¦–æ¬¡æ„å»ºé•œåƒï¼ˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰...  # â† é¦–æ¬¡æ„å»ºï¼Œä¸‹è½½ä¾èµ–
Step 4/8 : COPY requirements.txt .
Step 5/8 : RUN pip install -r requirements.txt
# ... ä¸‹è½½å¹¶å®‰è£…ä¾èµ– ...
```

### åœºæ™¯ 2ï¼šæ›´æ–°ä»£ç åé‡æ–°éƒ¨ç½²

```bash
git pull  # æ‹‰å–æœ€æ–°ä»£ç 
cd deployment
./deploy.sh deploy  # â† æ™ºèƒ½é‡å»ºï¼Œåˆ©ç”¨ç¼“å­˜
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
[ä¿¡æ¯] æ£€æµ‹åˆ°å·²å­˜åœ¨çš„é•œåƒ
[ä¿¡æ¯] é•œåƒå·²å­˜åœ¨ï¼Œä½¿ç”¨ç¼“å­˜é‡å»º...  # â† åˆ©ç”¨ç¼“å­˜ï¼
Step 4/8 : COPY requirements.txt
 ---> Using cache                          # â† ç¼“å­˜å‘½ä¸­
 ---> abc123def456
Step 5/8 : RUN pip install -r requirements.txt
 ---> Using cache                          # â† ç¼“å­˜å‘½ä¸­ï¼è·³è¿‡ä¾èµ–ä¸‹è½½
 ---> def456ghi789
Step 6/8 : COPY src/ src/
 ---> 123456789abc                         # â† åªé‡å»ºä»£ç å±‚
```

**è€—æ—¶å¯¹æ¯”**ï¼š
- é¦–æ¬¡æ„å»ºï¼š~8 åˆ†é’Ÿ
- ä»£ç æ›´æ–°åé‡å»ºï¼š~30 ç§’ï¼ˆå¿« 16 å€ï¼ï¼‰

### åœºæ™¯ 3ï¼šæ›´æ–°ä¾èµ–ï¼ˆå¦‚ requirements.txt æ”¹å˜ï¼‰

```bash
# ä¿®æ”¹äº† requirements.txt
./deploy.sh deploy --build  # â† å¼ºåˆ¶é‡æ–°å®‰è£…ä¾èµ–
```

### åœºæ™¯ 4ï¼šå¿«é€Ÿé‡å¯æœåŠ¡ï¼ˆä¸ä¿®æ”¹ä»£ç ï¼‰

```bash
./deploy.sh restart  # â† æœ€å¿«ï¼Œ5ç§’å®Œæˆ
```

### åœºæ™¯ 5ï¼šä»…åœæ­¢/å¯åŠ¨æœåŠ¡

```bash
./deploy.sh stop   # åœæ­¢æœåŠ¡
./deploy.sh start  # å¯åŠ¨æœåŠ¡ï¼ˆä½¿ç”¨ç°æœ‰é•œåƒï¼‰
```

---

## ğŸ”§ æ‰€æœ‰å‘½ä»¤è¯¦è§£

### åŸºç¡€å‘½ä»¤

```bash
./deploy.sh deploy        # å®Œæ•´éƒ¨ç½²ï¼ˆæ™ºèƒ½æ„å»ºï¼‰
./deploy.sh start         # å¿«é€Ÿå¯åŠ¨
./deploy.sh stop          # åœæ­¢æœåŠ¡
./deploy.sh restart       # é‡å¯æœåŠ¡
```

### é«˜çº§å‘½ä»¤

```bash
./deploy.sh status        # æŸ¥çœ‹è¯¦ç»†çŠ¶æ€ï¼ˆå®¹å™¨ã€é•œåƒã€ç½‘ç»œã€æ—¥å¿—ï¼‰
./deploy.sh logs          # æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
./deploy.sh logs rumor-api    # æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
./deploy.sh clean         # æ·±åº¦æ¸…ç†ï¼ˆåˆ é™¤å®¹å™¨ã€é•œåƒã€å·ï¼‰
```

### å¼ºåˆ¶é€‰é¡¹

```bash
./deploy.sh deploy --build       # å¼ºåˆ¶é‡æ–°æ„å»ºï¼ˆå¿½ç•¥ç¼“å­˜ï¼‰
./deploy.sh deploy --recreate    # å¼ºåˆ¶é‡æ–°åˆ›å»ºå®¹å™¨
./deploy.sh rebuild              # å¼ºåˆ¶é‡æ–°æ„å»ºï¼ˆä¸ä½¿ç”¨ç¼“å­˜ï¼‰
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### å¼€å‘ç¯å¢ƒ

```bash
# ä»£ç ä¿®æ”¹å
./deploy.sh restart  # é‡å¯å³å¯ï¼ˆä»£ç å·²æŒ‚è½½ä¸º volumeï¼‰

# æˆ–è€…
docker restart rumor-api rumor-web
```

### ç”Ÿäº§ç¯å¢ƒ

```bash
# 1. æ‹‰å–æœ€æ–°ä»£ç 
git pull

# 2. æ™ºèƒ½éƒ¨ç½²ï¼ˆåˆ©ç”¨ç¼“å­˜ï¼‰
./deploy.sh deploy

# 3. æ£€æŸ¥çŠ¶æ€
./deploy.sh status
```

### ä¾èµ–æ›´æ–°åœºæ™¯

```bash
# 1. ä¿®æ”¹ requirements.txt
vim requirements.txt

# 2. å¼ºåˆ¶é‡æ–°æ„å»º
./deploy.sh deploy --build
```

---

## âš¡ æ€§èƒ½å¯¹æ¯”

| æ“ä½œ | æ—§ç‰ˆæœ¬ï¼ˆv2.0ï¼‰ | æ–°ç‰ˆæœ¬ï¼ˆv2.1ï¼‰ | æå‡ |
|------|---------------|---------------|------|
| é¦–æ¬¡éƒ¨ç½² | 8 åˆ†é’Ÿ | 8 åˆ†é’Ÿ | - |
| ä»£ç æ›´æ–°éƒ¨ç½² | 8 åˆ†é’Ÿ | 30 ç§’ | **16x** |
| é‡å¯æœåŠ¡ | 8 åˆ†é’Ÿ | 5 ç§’ | **96x** |
| ä¾èµ–æ›´æ–° | 8 åˆ†é’Ÿ | 8 åˆ†é’Ÿ | - |

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šæ„å»ºå¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†æ„å»ºæ—¥å¿—
docker compose build --no-cache --progress=plain

# å¸¸è§åŸå› ï¼š
# - ç½‘ç»œé—®é¢˜ï¼špip ä¸‹è½½å¤±è´¥
# - ä¾èµ–å†²çªï¼šrequirements.txt ç‰ˆæœ¬ä¸å…¼å®¹
```

### é—®é¢˜ 2ï¼šå®¹å™¨å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs rumor-api

# å¸¸è§åŸå› ï¼š
# - .env é…ç½®é”™è¯¯ï¼ˆAPI Key æ— æ•ˆï¼‰
# - ç«¯å£å†²çª
```

### é—®é¢˜ 3ï¼šå¼ºåˆ¶é‡å»º

```bash
# å®Œå…¨é‡ç½®ï¼ˆæ¸…ç† + é‡å»ºï¼‰
./deploy.sh clean    # åˆ é™¤æ‰€æœ‰
./deploy.sh deploy   # é‡æ–°éƒ¨ç½²
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **å®Œæ•´æ•…éšœæ’æŸ¥**: `SERVER_DEPLOYMENT_FIX.md`
- **éƒ¨ç½²æ–‡ä»¶è¯´æ˜**: `README_DEPLOYMENT.md`
- **å¸®åŠ©ä¿¡æ¯**: `./deploy.sh help`
