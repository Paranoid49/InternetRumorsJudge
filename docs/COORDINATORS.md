# åè°ƒå™¨æ¨¡å—æ–‡æ¡£

## æ¦‚è¿°

åè°ƒå™¨æ¨¡å—ï¼ˆ`src/core/coordinators/`ï¼‰æä¾›äº†æµç¨‹ç¼–æ’çš„æ ¸å¿ƒç»„ä»¶ï¼Œå°†åŸæœ¬é›†ä¸­åœ¨ `pipeline.py` ä¸­çš„å¤æ‚é€»è¾‘æ‹†åˆ†ä¸ºèŒè´£å•ä¸€çš„åè°ƒå™¨ç±»ã€‚

## æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        RumorJudgeEngine (é—¨é¢)            â”‚
â”‚  - å•ä¾‹æ¨¡å¼                                â”‚
â”‚  - ç»„ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†                        â”‚
â”‚  - ç»Ÿä¸€é”™è¯¯å¤„ç†                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          åè°ƒå™¨å±‚                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ QueryProcessor                            â”‚
â”‚  â”œâ”€ parse_query()                        â”‚
â”‚  â”œâ”€ check_cache()                        â”‚
â”‚  â”œâ”€ parse_with_parallel_retrieval()      â”‚ â† v0.5.1
â”‚  â””â”€ process()                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ RetrievalCoordinator                     â”‚
â”‚  â”œâ”€ retrieve()                           â”‚
â”‚  â”œâ”€ retrieve_with_parsed_query()         â”‚ â† v0.5.1
â”‚  â”œâ”€ retrieve_local_only()                 â”‚
â”‚  â”œâ”€ _deduplicate_docs()                  â”‚ â† v0.5.1
â”‚  â”œâ”€ _convert_to_dict_format()            â”‚ â† v0.5.1
â”‚  â””â”€ get_retrieval_stats()                â”‚ â† v0.5.1
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ AnalysisCoordinator                      â”‚
â”‚  â”œâ”€ analyze()                            â”‚
â”‚  â”œâ”€ summarize_assessments()               â”‚
â”‚  â””â”€ get_high_quality_evidence()          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ VerdictGenerator                          â”‚
â”‚  â”œâ”€ generate()                           â”‚
â”‚  â”œâ”€ format_for_cache()                    â”‚
â”‚  â””â”€ extract_key_info()                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ ¸å¿ƒèŒè´£

### 1. QueryProcessorï¼ˆæŸ¥è¯¢å¤„ç†å™¨ï¼‰

**èŒè´£**ï¼š
- è§£ææŸ¥è¯¢ï¼ˆæå–å®ä½“ã€ä¸»å¼ ã€åˆ†ç±»ï¼‰
- ç¼“å­˜æ£€æŸ¥
- å¹¶è¡Œæ‰§è¡ŒæŸ¥è¯¢è§£æå’Œæœ¬åœ°æ£€ç´¢ï¼ˆæŠ¢è·‘ç­–ç•¥ï¼‰

**å…³é”®æ–¹æ³•**ï¼š
```python
def parse_with_parallel_retrieval(query: str) -> Tuple[QueryAnalysis, List]
    """
    å¹¶è¡Œæ‰§è¡ŒæŸ¥è¯¢è§£æå’Œæœ¬åœ°æ£€ç´¢

    ç­–ç•¥ï¼š
    - ä»»åŠ¡1: LLMè§£ææŸ¥è¯¢æ„å›¾
    - ä»»åŠ¡2: åŸå§‹è¯ç›´æ¥æ£€ç´¢æœ¬åœ°åº“ï¼ˆæŠ¢è·‘ï¼‰

    è¿”å›: (è§£æç»“æœ, æœ¬åœ°æ–‡æ¡£åˆ—è¡¨)
    """
```

**è®¾è®¡äº®ç‚¹**ï¼š
- âš¡ æ€§èƒ½ä¼˜åŒ–ï¼šå¹¶è¡Œæ‰§è¡Œï¼Œå‡å°‘æ€»è€—æ—¶
- ğŸ¯ æŠ¢è·‘ç­–ç•¥ï¼šåˆ©ç”¨LLMåˆ†ææ—¶é—´é¢„å…ˆæ£€ç´¢

### 2. RetrievalCoordinatorï¼ˆæ£€ç´¢åè°ƒå™¨ï¼‰

**èŒè´£**ï¼š
- åè°ƒæœ¬åœ°æ£€ç´¢å’Œç½‘ç»œæœç´¢
- è§£æè¯è¡¥æµ‹
- è¯æ®å»é‡
- æ ¼å¼è½¬æ¢

**å…³é”®æ–¹æ³•**ï¼š
```python
def retrieve_with_parsed_query(
    query: str,
    parsed_info: QueryAnalysis,
    local_docs: List = None
) -> List[Dict]:
    """
    ä½¿ç”¨è§£æåçš„æŸ¥è¯¢è¿›è¡Œæ£€ç´¢

    ç­–ç•¥ï¼š
    1. è§£æè¯å’ŒåŸå§‹è¯ä¸åŒæ—¶ï¼Œè¡¥æµ‹æœ¬åœ°åº“
    2. æ±‡æ€»æœ¬åœ°ç»“æœå¹¶å»é‡
    3. è°ƒç”¨æ··åˆæ£€ç´¢ï¼ˆæœ¬åœ°+ç½‘ç»œï¼‰
    4. è½¬æ¢ä¸ºç»Ÿä¸€æ ¼å¼
    """
```

**è®¾è®¡äº®ç‚¹**ï¼š
- ğŸ” å¤šé˜¶æ®µæ£€ç´¢ï¼šæŠ¢è·‘ â†’ è¡¥æµ‹ â†’ æ··åˆ
- ğŸ§¹ å»é‡ç­–ç•¥ï¼šå†…å®¹å“ˆå¸Œå»é‡
- ğŸ“Š æ ¼å¼ç»Ÿä¸€ï¼šDocumentå¯¹è±¡ â†’ å­—å…¸æ ¼å¼

### 3. AnalysisCoordinatorï¼ˆåˆ†æåè°ƒå™¨ï¼‰

**èŒè´£**ï¼š
- åè°ƒè¯æ®åˆ†æ
- æ±‡æ€»åˆ†æç»“æœ
- ç­›é€‰é«˜è´¨é‡è¯æ®

**å…³é”®æ–¹æ³•**ï¼š
```python
def analyze(claim: str, evidence_list: List[Dict]) -> List[EvidenceAssessment]:
    """
    åˆ†æè¯æ®åˆ—è¡¨

    ç­–ç•¥ï¼š
    - æ‰¹é‡å¹¶è¡Œåˆ†æï¼ˆ2-5ä¸ªè¯æ®å•çº¿ç¨‹ï¼Œ>5ä¸ªåˆ†ç‰‡å¹¶è¡Œï¼‰
    - æ”¯æŒé¢„è¿‡æ»¤æœºåˆ¶
    """
```

### 4. VerdictGeneratorï¼ˆè£å†³ç”Ÿæˆå™¨ï¼‰

**èŒè´£**ï¼š
- ç”Ÿæˆæœ€ç»ˆè£å†³
- å…œåº•æœºåˆ¶
- æ ¼å¼åŒ–è¾“å‡º

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨

```python
from src.core.pipeline import RumorJudgeEngine

# è·å–å¼•æ“å®ä¾‹
engine = RumorJudgeEngine()

# æ‰§è¡Œæ ¸æŸ¥
result = engine.run("å–éš”å¤œæ°´ä¼šè‡´ç™Œå—ï¼Ÿ")

# è®¿é—®ç»“æœ
print(f"è£å†³: {result.final_verdict}")
print(f"ç½®ä¿¡åº¦: {result.confidence_score}%")
print(f"æ‘˜è¦: {result.summary_report}")
```

### åè°ƒå™¨ç‹¬ç«‹ä½¿ç”¨

```python
from src.core.coordinators import QueryProcessor, RetrievalCoordinator
from src.core.pipeline import RumorJudgeEngine

engine = RumorJudgeEngine()
engine._lazy_init()  # ç¡®ä¿ç»„ä»¶å·²åˆå§‹åŒ–

# ç›´æ¥ä½¿ç”¨åè°ƒå™¨
query_processor = QueryProcessor(
    parser_chain=engine.parser_chain,
    cache_manager=engine.cache_manager,
    hybrid_retriever=engine.hybrid_retriever
)

# å¹¶è¡Œè§£æå’Œæ£€ç´¢
parsed, local_docs = query_processor.parse_with_parallel_retrieval("æµ‹è¯•æŸ¥è¯¢")
```

## æ€§èƒ½ä¼˜åŒ–

### v0.5.1 å¼•å…¥çš„ä¼˜åŒ–

1. **å¹¶è¡Œæ‰§è¡Œ**ï¼š
   - æŸ¥è¯¢è§£æå’Œæœ¬åœ°æ£€ç´¢å¹¶è¡Œæ‰§è¡Œ
   - å‡å°‘50%+çš„æ€»ç­‰å¾…æ—¶é—´

2. **æŠ¢è·‘ç­–ç•¥**ï¼š
   - åˆ©ç”¨LLMåˆ†ææ—¶é—´é¢„å…ˆæ£€ç´¢
   - æå‰ç¼“å­˜å¯èƒ½éœ€è¦çš„ç»“æœ

3. **è§£æè¯è¡¥æµ‹**ï¼š
   - ä½¿ç”¨è§£æåçš„æŸ¥è¯¢è¯è¡¥æµ‹æœ¬åœ°åº“
   - æé«˜æ£€ç´¢å‘½ä¸­ç‡

4. **å»é‡ä¼˜åŒ–**ï¼š
   - å†…å®¹å“ˆå¸Œå»é‡
   - é¿å…é‡å¤è®¡ç®—

## è®¾è®¡æ¨¡å¼

### æ¨¡å¼1ï¼šé—¨é¢æ¨¡å¼ï¼ˆFacadeï¼‰

`RumorJudgeEngine` ä½œä¸ºé—¨é¢ï¼Œéšè—åè°ƒå™¨çš„å¤æ‚æ€§ï¼š

```python
# ç”¨æˆ·åªéœ€è°ƒç”¨ç®€å•çš„æ¥å£
result = engine.run("æŸ¥è¯¢")

# å†…éƒ¨è‡ªåŠ¨åè°ƒå¤šä¸ªç»„ä»¶
# - QueryProcessor
# - RetrievalCoordinator
# - AnalysisCoordinator
# - VerdictGenerator
```

### æ¨¡å¼2ï¼šç­–ç•¥æ¨¡å¼ï¼ˆStrategyï¼‰

ä¸åŒçš„æ£€ç´¢ç­–ç•¥å¯ä»¥é€šè¿‡ `RetrievalCoordinator` å®ç°ï¼š

- ç®€å•æ£€ç´¢ï¼š`retrieve()`
- è§£æè¯æ£€ç´¢ï¼š`retrieve_with_parsed_query()`
- ä»…æœ¬åœ°æ£€ç´¢ï¼š`retrieve_local_only()`

### æ¨¡å¼3ï¼šæ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼ˆTemplate Methodï¼‰

æ ‡å‡†åŒ–çš„å¤„ç†æµç¨‹ï¼š

1. æŸ¥è¯¢å¤„ç†
2. è¯æ®æ£€ç´¢
3. è¯æ®åˆ†æ
4. è£å†³ç”Ÿæˆ

## æ‰©å±•æ€§

### æ·»åŠ æ–°çš„æ£€ç´¢ç­–ç•¥

```python
class RetrievalCoordinator:
    def retrieve_with_custom_strategy(
        self,
        query: str,
        strategy: str = "hybrid"
    ):
        # è‡ªå®šä¹‰æ£€ç´¢ç­–ç•¥
        if strategy == "aggressive":
            # æ¿€è¿›ç­–ç•¥ï¼šæ›´å¤šç½‘ç»œæœç´¢
            pass
        elif strategy == "conservative":
            # ä¿å®ˆç­–ç•¥ï¼šä»…æœ¬åœ°æ£€ç´¢
            pass
```

### æ·»åŠ æ–°çš„åˆ†æç»´åº¦

```python
class AnalysisCoordinator:
    def analyze_with_dimension(
        self,
        claim: str,
        evidence_list: List[Dict],
        dimension: str = "comprehensive"
    ):
        # å¤šç»´åº¦åˆ†æ
        pass
```

## æµ‹è¯•

### åè°ƒå™¨å•å…ƒæµ‹è¯•

```python
# tests/unit/coordinators/test_query_processor.py
def test_parse_with_parallel_retrieval():
    processor = QueryProcessor(mock_parser, mock_cache, mock_retriever)
    parsed, docs = processor.parse_with_parallel_retrieval("æµ‹è¯•æŸ¥è¯¢")
    assert parsed is not None
    assert isinstance(docs, list)
```

### é›†æˆæµ‹è¯•

```python
# tests/integration/test_coordinators_integration.py
def test_full_pipeline_with_coordinators():
    engine = RumorJudgeEngine()
    result = engine.run("æµ‹è¯•æŸ¥è¯¢")
    assert result is not None
```

## ç»´æŠ¤æŒ‡å—

### ä¿®æ”¹åè°ƒå™¨æ—¶çš„æ³¨æ„äº‹é¡¹

1. **ä¿æŒæ¥å£ç¨³å®š**ï¼šåè°ƒå™¨æ˜¯å†…éƒ¨æ¨¡å—ï¼Œæ¥å£å˜æ›´éœ€è¦æ…é‡
2. **æ›´æ–°æ–‡æ¡£**ï¼šä»»ä½•åŠŸèƒ½å˜æ›´éƒ½è¦æ›´æ–°æœ¬æ–‡æ¡£
3. **æ·»åŠ æµ‹è¯•**ï¼šæ–°åŠŸèƒ½å¿…é¡»æ·»åŠ å•å…ƒæµ‹è¯•
4. **æ€§èƒ½æµ‹è¯•**ï¼šç¡®ä¿ä¼˜åŒ–æ²¡æœ‰å¼•å…¥æ€§èƒ½å›å½’

### å¸¸è§é—®é¢˜

**Q: åè°ƒå™¨ä¹‹é—´å¦‚ä½•é€šä¿¡ï¼Ÿ**
A: åè°ƒå™¨é€šè¿‡ `RumorJudgeEngine` é—¨é¢è¿›è¡Œåè°ƒï¼Œä¸ç›´æ¥é€šä¿¡ã€‚

**Q: å¦‚ä½•æ·»åŠ æ–°çš„æ£€ç´¢ç­–ç•¥ï¼Ÿ**
A: åœ¨ `RetrievalCoordinator` ä¸­æ·»åŠ æ–°æ–¹æ³•ï¼Œç„¶ååœ¨ `_run_with_coordinators` ä¸­è°ƒç”¨ã€‚

**Q: å¦‚ä½•æ‰©å±•åˆ†æç»´åº¦ï¼Ÿ**
A: åœ¨ `AnalysisCoordinator` ä¸­æ·»åŠ æ–°çš„åˆ†ææ–¹æ³•ã€‚

**Q: åè°ƒå™¨å¦‚ä½•å¤„ç†é”™è¯¯ï¼Ÿ**
A: æ¯ä¸ªåè°ƒå™¨å†…éƒ¨å¤„ç†å¼‚å¸¸ï¼Œè¿”å›å…œåº•ç»“æœã€‚å¼‚å¸¸ä¼šè®°å½•åˆ°æ—¥å¿—ã€‚

---

**æœ€åæ›´æ–°**ï¼š2026-02-07 16:20:00
**ç»´æŠ¤è€…**ï¼šClaude (å®ˆé—¨å‘˜)
